generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum VoucherStatus {
  DRAFT
  POSTED
  CANCELLED
}

enum EntrySide {
  DEBIT
  CREDIT
}

/**
 * PURPOSE / ROLE of an account inside its type
 * Used by API resolver (not accounting logic)
 */
enum AccountRole {
  CASH
  BANK
  SALES
  PURCHASE
  AR
  AP
  OWNER
}

//////////////////////////////////////////////////////
// CORE MODELS
//////////////////////////////////////////////////////

model Company {
  id                   String        @id @default(cuid())
  code                 String        @unique
  name                 String
  baseCurrency         String        @default("INR")
  fiscalYearStartMonth Int           @default(4)
  createdAt            DateTime      @default(now())

  accounts             Account[]
  accountTypes         AccountType[]
  voucherTypes         VoucherType[]
  vouchers             Voucher[]
}

model AccountType {
  id        String   @id @default(cuid())
  code      String   @unique    // ASSET, LIABILITY, INCOME, EXPENSE, EQUITY
  name      String

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  accounts  Account[]
}

model Account {
  id            String      @id @default(cuid())
  code          String      @unique        // internal identifier
  name          String

  role          AccountRole // ✅ NEW — critical for API resolution

  company       Company     @relation(fields: [companyId], references: [id])
  companyId     String

  accountType   AccountType @relation(fields: [accountTypeId], references: [id])
  accountTypeId String

  entries       Entry[]
}

//////////////////////////////////////////////////////
// VOUCHERS
//////////////////////////////////////////////////////

model VoucherType {
  id        String   @id @default(cuid())
  code      String   @unique    // SALE, PURCHASE, RECEIPT, PAYMENT
  name      String

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  vouchers  Voucher[]
}

model Voucher {
  id            String        @id @default(cuid())
  company       Company       @relation(fields: [companyId], references: [id])
  companyId     String

  voucherType   VoucherType   @relation(fields: [voucherTypeId], references: [id])
  voucherTypeId String

  status        VoucherStatus @default(DRAFT)
  voucherDate   DateTime
  narration     String?

  entries       Entry[]

  createdAt     DateTime      @default(now())
}

model Entry {
  id        String    @id @default(cuid())
  voucher   Voucher  @relation(fields: [voucherId], references: [id])
  voucherId String

  account   Account  @relation(fields: [accountId], references: [id])
  accountId String

  side      EntrySide
  amount    Decimal  @db.Decimal(18, 2)
}
